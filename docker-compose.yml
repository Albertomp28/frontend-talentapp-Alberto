# ========================================
# Unified Docker Compose for Talent App Frontend
# ========================================
# This compose file includes the frontend development and production services.
# For the complete stack (frontend + backend + database + AI service),
# use the root docker-compose.yml file.

services:
  # ========================================
  # Frontend Development Service
  # ========================================
  frontend-dev:
    build:
      context: .
      target: development
      dockerfile: Dockerfile
    container_name: talentapp-frontend-dev
    ports:
      - "${FRONTEND_PORT:-5173}:5173"
    volumes:
      # Mount source code for hot reload
      - .:/app
      # Prevent overwriting container's node_modules
      - /app/node_modules
      - /app/dist
    environment:
      - NODE_ENV=development
      - VITE_API_URL=http://host.docker.internal:3000
      - VITE_CV_PROCESSOR_URL=http://host.docker.internal:8000
      - VITE_CV_PROCESSOR_API_KEY=Cv0L-lhxhL4zu0BW8XXbBJboR4-KfS8eBjyYNJPjSj4KUcFCwgGKYA
    stdin_open: true
    tty: true
    # WSL2 host access configuration
    extra_hosts:
      - "host.docker.internal:host-gateway"
    # Health check - wait for Vite dev server to be ready
    healthcheck:
      test: [ "CMD", "wget", "--spider", "-q", "http://localhost:5173" ]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    networks:
      - talentapp-network
    restart: unless-stopped

  # ========================================
  # Frontend Production Service (Nginx)
  # ========================================
  frontend-prod:
    build:
      context: .
      target: production
      dockerfile: Dockerfile
    container_name: talentapp-frontend-prod
    ports:
      - "${FRONTEND_PROD_PORT:-80}:80"
    environment:
      - NODE_ENV=production
    healthcheck:
      test: [ "CMD", "wget", "--spider", "-q", "http://localhost/health" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    networks:
      - talentapp-network
    restart: unless-stopped
    profiles:
      - production

networks:
  talentapp-network:
    name: talentapp-network
    driver: bridge
